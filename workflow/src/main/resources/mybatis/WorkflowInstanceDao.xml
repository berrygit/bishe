<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="berry.db.dao.WorkflowInstanceDao">

<resultMap id="instanceMap" type="berry.db.po.WorkflowInstanceBean">
	<result column="gmt_begin" property="gmtBegin"></result>
</resultMap>

<insert id="createInstance" useGeneratedKeys="true" keyProperty="id" parameterType="berry.db.po.WorkflowInstanceBean" >  
    INSERT INTO WORKFLOW_INSTANCE (REQUEST_ID, WORKFLOW_NAME, INIT_INFO, STATUS, TIMEOUT_MILS, GMT_BEGIN, GMT_UPDATE) 
        VALUES (#{requestId}, #{workflowName}, #{initInfo}, #{status}, #{timeoutMils}, now(), now())
</insert>

<select id="getInstance" parameterType="berry.db.po.WorkflowInstanceBean" resultMap="instanceMap">  
    SELECT * FROM WORKFLOW_INSTANCE WHERE REQUEST_ID=#{requestId} AND WORKFLOW_NAME=#{workflowName}
</select>

<update id="updateStatus" parameterType="berry.db.po.WorkflowInstanceBean">  
    UPDATE WORKFLOW_INSTANCE SET STATUS=#{status}, GMT_UPDATE = now() WHERE REQUEST_ID=#{requestId} AND WORKFLOW_NAME=#{workflowName}
</update>

</mapper>  